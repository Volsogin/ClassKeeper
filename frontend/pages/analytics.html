<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - ClassKeeper</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <script src="/js/navbar.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand"><h2>üéì ClassKeeper</h2></div>
        <div class="navbar-menu">
            <a href="/pages/dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/pages/users.html">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
            <a href="/pages/subjects.html">–ü—Ä–µ–¥–º–µ—Ç—ã</a>
            <a href="/pages/classes.html">–ö–ª–∞—Å—Å—ã</a>
            <a href="/pages/schedule.html">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
            <a href="/pages/grades.html">–û—Ü–µ–Ω–∫–∏</a>
            <a href="/pages/attendance.html">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</a>
            <a href="/pages/homework.html">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</a>
            <a href="/pages/announcements.html">–û–±—ä—è–≤–ª–µ–Ω–∏—è</a>
            <a href="/pages/analytics.html" class="active">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
        </div>
        <div class="navbar-user">
            <span id="user-name"></span>
            <button onclick="logout()" class="btn btn-secondary">–í—ã—Ö–æ–¥</button>
        </div>
    </nav>

    <div class="dashboard-container">
        <h1>üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
        <div id="stats-container" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-top:30px;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let token = localStorage.getItem('token');
        if (!token) window.location.href = '/';

        document.addEventListener('DOMContentLoaded', loadStats);

        async function loadStats() {
            const container = document.getElementById('stats-container');
            
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            const usersRes = await fetch(`${API_BASE}/users`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const usersData = await usersRes.json();
            const users = usersData.users || [];

            // –ö–ª–∞—Å—Å—ã
            const classesRes = await fetch(`${API_BASE}/classes`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const classesData = await classesRes.json();
            const classes = classesData.classes || [];

            // –ü—Ä–µ–¥–º–µ—Ç—ã
            const subjectsRes = await fetch(`${API_BASE}/subjects`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const subjectsData = await subjectsRes.json();
            const subjects = subjectsData.subjects || [];

            // –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
            const homeworkRes = await fetch(`${API_BASE}/homework`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            const homeworkData = await homeworkRes.json();
            const homework = homeworkData.homework || [];

            container.innerHTML = `
                <div class="stat-card" style="background:#667eea;color:white;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${users.filter(u => u.role === 'student').length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–£—á–µ–Ω–∏–∫–æ–≤</p>
                </div>
                <div class="stat-card" style="background:#51cf66;color:white;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${users.filter(u => u.role === 'teacher').length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–£—á–∏—Ç–µ–ª–µ–π</p>
                </div>
                <div class="stat-card" style="background:#ffd43b;color:#1a1a1a;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${classes.length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–ö–ª–∞—Å—Å–æ–≤</p>
                </div>
                <div class="stat-card" style="background:#ff6b6b;color:white;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${subjects.length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–ü—Ä–µ–¥–º–µ—Ç–æ–≤</p>
                </div>
                <div class="stat-card" style="background:#4dabf7;color:white;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${homework.length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–î–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</p>
                </div>
                <div class="stat-card" style="background:#f59f00;color:white;padding:30px;border-radius:12px;text-align:center;">
                    <h2 style="font-size:3rem;margin:0;">${users.filter(u => u.role === 'parent').length}</h2>
                    <p style="margin:10px 0 0 0;font-size:1.2rem;">–†–æ–¥–∏—Ç–µ–ª–µ–π</p>
                </div>
            `;
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/';
        }
    </script>
</body>
</html>
